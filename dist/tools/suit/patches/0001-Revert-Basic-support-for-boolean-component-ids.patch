From 2c0b4f4319ad610ff9d3f7e761887f937bde63dc Mon Sep 17 00:00:00 2001
From: Benjamin Valentin <benpicco@googlemail.com>
Date: Sat, 26 Sep 2020 16:25:32 +0200
Subject: [PATCH] Revert "Basic support for boolean component ids"

This reverts commit 26ba4e71f38377831d8029334c5bb14e2f853167.
---
 suit_tool/manifest.py | 40 ++++------------------------------------
 1 file changed, 4 insertions(+), 36 deletions(-)

diff --git a/suit_tool/manifest.py b/suit_tool/manifest.py
index 25372e0..4e38313 100644
--- a/suit_tool/manifest.py
+++ b/suit_tool/manifest.py
@@ -393,38 +393,6 @@ class SUITComponentId(SUITManifestArray):
     def __hash__(self):
         return hash(tuple([i.v for i in self.items]))
 
-def mkBoolOrObj(cls):
-    class BoolOrObj():
-        def from_json(self, d):
-            if isinstance(d, bool):
-                self.v = d
-            else:
-                self.v = cls().from_json(d)
-            return self
-        def from_suit(self, d):
-            if isinstance(d, bool):
-                self.v = d
-            else:
-                self.v = cls().from_suit(d)
-            return self
-        def to_json(self):
-            if isinstance(self.v, bool):
-                return self.v
-            else:
-                return self.to_json()
-        def to_suit(self):
-            if isinstance(self.v, bool):
-                return self.v
-            else:
-                return self.to_suit()
-
-        def to_debug(self, indent):
-            if isinstance(self.v, bool):
-                return str(self.v)
-            else:
-                return self.to_debug(indent)
-    return BoolOrObj
-
 class SUITComponentIndex(SUITComponentId):
     def to_suit(self):
         return suitCommonInfo.component_id_to_index(self)
@@ -525,9 +493,9 @@ def SUITCommandContainer(jkey, skey, argtype, dp=[]):
                 raise Except('JSON Key mismatch error')
             if self.json_key != 'directive-set-component-index' and self.json_key != 'directive-set-dependency-index':
                 try:
-                    self.cid = mkBoolOrObj(SUITComponentId)().from_json(j['component-id'])
+                    self.cid = SUITComponentId().from_json(j['component-id'])
                 except:
-                    self.cid = mkBoolOrObj(SUITDigest)().from_json(j['component-id'])
+                    self.cid = SUITDigest().from_json(j['component-id'])
             self.arg = argtype().from_json(j['command-arg'])
             return self
         def from_suit(self, s):
@@ -576,8 +544,8 @@ SUITCommand.commands = [
     SUITCommandContainer('condition-minimum-battery',      26, mkPolicy(policy=0xA)),
     SUITCommandContainer('condition-update-authorised',    27, mkPolicy(policy=0x3)),
     SUITCommandContainer('condition-version',              28, mkPolicy(policy=0xF)),
-    SUITCommandContainer('directive-set-component-index',  12, mkBoolOrObj(SUITPosInt)),
-    SUITCommandContainer('directive-set-dependency-index', 13, mkBoolOrObj(SUITPosInt)),
+    SUITCommandContainer('directive-set-component-index',  12, SUITPosInt),
+    SUITCommandContainer('directive-set-dependency-index', 13, SUITPosInt),
     SUITCommandContainer('directive-abort',                14, mkPolicy(policy=0x2)),
     SUITCommandContainer('directive-try-each',             15, SUITTryEach),
     SUITCommandContainer('directive-process-dependency',   18, mkPolicy(policy=0)),
-- 
2.25.1

