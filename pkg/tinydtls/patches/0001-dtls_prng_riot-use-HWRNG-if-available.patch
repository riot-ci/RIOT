From c84d597e674b51381be76427d1cc4220ab9de6dd Mon Sep 17 00:00:00 2001
From: Benjamin Valentin <benjamin.valentin@ml-pa.com>
Date: Tue, 7 Jul 2020 14:36:14 +0200
Subject: [PATCH] dtls_prng_riot: use HWRNG if available

---
 platform-specific/dtls_prng_riot.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/platform-specific/dtls_prng_riot.c b/platform-specific/dtls_prng_riot.c
index 1726444..c59633b 100644
--- a/platform-specific/dtls_prng_riot.c
+++ b/platform-specific/dtls_prng_riot.c
@@ -20,9 +20,22 @@
 
 #include "tinydtls.h"
 #include "dtls_prng.h"
+#include "periph/hwrng.h"
 
 #include <stdlib.h>
 
+#ifdef MODULE_PERIPH_HWRNG
+int
+dtls_prng(unsigned char *buf, size_t len) {
+  hwrng_read(buf, len);
+  return 1;
+}
+
+void
+dtls_prng_init(unsigned seed) {
+  (void) seed;
+}
+#else
 /**
  * Fills \p buf with \p len random bytes. This is the default
  * implementation for prng().  You might want to change prng() to use
@@ -39,4 +52,5 @@ void
 dtls_prng_init(unsigned seed) {
   srand(seed);
 }
+#endif
 
-- 
2.25.1

